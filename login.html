<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æœƒå“¡ç™»å…¥</title>
</head>
<body>
  <h2>æœƒå“¡ç™»å…¥</h2>
  <form id="loginForm">
    <input id="phone" placeholder="è«‹è¼¸å…¥è¡Œå‹•é›»è©±"><br>
    <input id="birthday" placeholder="è«‹è¼¸å…¥ç”Ÿæ—¥(ä¾‹å¦‚0640515)"><br>
    <button type="submit">ç™»å…¥</button>
  </form>
  <div id="loginResult" style="margin-top:12px;"></div>

<script>
    const form = document.getElementById('loginForm');
    const resultDiv = document.getElementById('loginResult');
    // è«‹å‹™å¿…æ›¿æ›æˆæ‚¨éƒ¨ç½²å¾Œçš„å¯¦éš› GAS Web App URL
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxErs-JTQsj87dlJMWaN3ArAGmMy9hFL1_tFy9suxuj54FdB7wAxrQe3IpIR4tClPX7QQ/exec";

    form.addEventListener('submit', async function(e){
      e.preventDefault();
      resultDiv.textContent = 'ç™»å…¥ä¸­...';
      const phone = document.getElementById('phone').value.trim();
      const birthday = document.getElementById('birthday').value.trim();

      try {
        const resp = await fetch(GAS_URL, {
          method: "POST",
          body: JSON.stringify({ action:"login", phone, birthday }),
          headers: { "Content-Type": "application/json" }
        });
        const data = await resp.json();
        
        if (data.success && data.token) { // ğŸ”¹ æª¢æŸ¥æˆåŠŸä¸¦å¸¶æœ‰ Token
          // å°‡ Token å„²å­˜èµ·ä¾†ï¼Œç”¨æ–¼å¾ŒçºŒå­˜å–é€šè¨ŠéŒ„
          localStorage.setItem('userToken', data.token); 
          resultDiv.textContent = 'ç™»å…¥æˆåŠŸï¼Œæ­£åœ¨è·³è½‰...';
          window.location.href = "list.html";
        } else {
          resultDiv.textContent = data.msg || "ç™»å…¥å¤±æ•—";
          localStorage.removeItem('userToken'); // æ¸…é™¤å¯èƒ½æ®˜ç•™çš„ Token
        }
      } catch (err) {
        resultDiv.textContent = "é€£ç·šéŒ¯èª¤ï¼š" + err.message;
      }
    });
</script>
</body>
</html>
