<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>會員登入</title>
</head>
<body>
  <h2>會員登入</h2>
  <form id="loginForm">
    <input id="phone" placeholder="請輸入行動電話"><br>
    <input id="birthday" placeholder="請輸入生日(例如0640515)"><br>
    <button type="submit">登入</button>
  </form>
  <div id="loginResult" style="margin-top:12px;"></div>

<script>
    const form = document.getElementById('loginForm');
    const resultDiv = document.getElementById('loginResult');
    // 請務必替換成您部署後的實際 GAS Web App URL
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxErs-JTQsj87dlJMWaN3ArAGmMy9hFL1_tFy9suxuj54FdB7wAxrQe3IpIR4tClPX7QQ/exec";

    form.addEventListener('submit', async function(e){
      e.preventDefault();
      resultDiv.textContent = '登入中...';
      const phone = document.getElementById('phone').value.trim();
      const birthday = document.getElementById('birthday').value.trim();

      try {
        const resp = await fetch(GAS_URL, {
          method: "POST",
          body: JSON.stringify({ action:"login", phone, birthday }),
          headers: { "Content-Type": "application/json" }
        });
        const data = await resp.json();
        
        if (data.success && data.token) { // 🔹 檢查成功並帶有 Token
          // 將 Token 儲存起來，用於後續存取通訊錄
          localStorage.setItem('userToken', data.token); 
          resultDiv.textContent = '登入成功，正在跳轉...';
          window.location.href = "list.html";
        } else {
          resultDiv.textContent = data.msg || "登入失敗";
          localStorage.removeItem('userToken'); // 清除可能殘留的 Token
        }
      } catch (err) {
        resultDiv.textContent = "連線錯誤：" + err.message;
      }
    });
</script>
</body>
</html>
